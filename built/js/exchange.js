require(["zepto","api","util"],function($,e,a){function n(){var a=e.getHost().host+"/PrizeActivity/PrizeActivity/GetUserBalance",n=function(a){if(!a.state)return void(-5==a.code&&(window.location.href=e.exchangeLoginHref));var n=a.data;$(".jsBean").html(n.joyBeans),$(".jsCoin").html(n.joyCoin),i=n.joyBeans,o=n.joyCoin,i>=1?($(".jsNoBean").addClass("hidden"),$(".jsMount").removeClass("hidden")):($(".jsNoBean").removeClass("hidden"),$(".jsMount").addClass("hidden"))};e.request(a,n,"","get","jsonp")}function t(){var e=$(".jsBeanInput").val();max=i,min=1,realVal=e.replace(/^\D+$/g,"").replace(/^\D*0*(\d+(\d{0,0})?).*$/,"$1")||"",realVal=realVal>max?max:realVal,e&&realVal!=e&&$(this).val(realVal),rrealVal=(realVal+"").replace(/\.$/g,""),rrealVal.length>=2&&rrealVal<1&&(rrealVal=realVal<1*min?min:realVal),$(".jsBeanInput").val(rrealVal),$(".jsChangeCoin").html(rrealVal*l),s=rrealVal*l}function r(){var t=$(".jsBeanInput").val();if(t<1||s<=0)return void a.ntips_center("输入欢乐豆必须大于等于1");var r=e.getHost().host+"/PrizeActivity/PrizeActivity/ExchangeBeanToCoin",l={changeCount:t},i=function(e){if(s=0,$(".jsBeanInput").val(""),$(".jsChangeCoin").html(""),!e.state)return void a.ntips_center(e.msg);var t="成功兑换"+e.data.exchangeJoyCoin+"个欢乐币";a.ntips_center(t),n()};e.request(r,i,l,"get","jsonp")}var l=10,i=0,o=0,s=0;n(),$(".jsBeanInput").on("input propertychnage",t),$(".jsChangeBtn").on("click",r),$(".jsrrcs").on("click",function(){window.location.href=e.getHost().rrcs})});