define(["zepto","util","catch/roll","catch/parabola","catch/task","template","api","plugins/tool"],function($,e,t,a,i,r,o,s){function l(){v=$(".doll-ft"),b=$(".doll-stage"),y=$(".jsBetBtn")}function d(){v.on(x,".jsBetBtn",m),v.on(x,".bet-bean-item",c),t.getRank(function(){var t=e.store.get("gameType"),n=$(".doll-bet-bean").children(".bet-bean-item");(void 0===t||null===t||t>n.length-1)&&(t=0),n.eq(t).trigger(x)})}function c(){if(y.attr("disabled"))return!1;var n=$(this);if(n.hasClass("current"))return!1;n.siblings().removeClass("current"),n.addClass("current"),B.onebet=n.attr("data-money"),B.currentChip=n;var a=n.index(),i=$("body"),r=$("#jsTitLevel");1==a?(i.attr("id","doll-middle"),r.attr("class","tit tit-middle")):2==a?(r.attr("class","tit tit-high"),i.attr("id","doll-high")):(r.attr("class","tit tit-primary"),i.removeAttr("id")),e.store.set("gameType",a),t.rollProducts()}function m(){function t(){var t=null;(function(){for(var e=g.offset(),n=h.offset(),a=n.left+n.width,i=0;i<L.length;i++){var r=L.eq(i).find(".doll"),o=r.offset(),s=o.left+o.width,l=o.top;if(o.left+20>=e.left&&s-20<=a){var d=g.offset().top;if(l<z+d){t=r.parent(".doll-item");break}}}})(),t?function(){function a(t){function a(){function a(){var a=$(".jsHoldFail"),o=(a.get(0),k.html());k.empty().attr("style",""),a.html(o),A.style[v.transition]="",new Parabola({origin:".jsHoldFail",target:".jsTarget",scale:10,a:-.009,element:".jsHoldFail",time:800,callback:function(o){if(a.empty().attr("style",""),2!=p||($(".reddot").show(),e.store.set("dollOrder",1),$(".jsRecordItem").attr("href","record.html?index=1")),k.attr("style","").empty(),"1"==p){e.atips_center("success","恭喜你！获得"+t.money+"欢乐豆",function(){var e=$(".jsAdd"),n=e.find("b"),a=t.money;n.html(a),e.removeClass("none"),window.setTimeout(function(){e.addClass("none"),y.removeAttr("disabled")},2e3)});var l=1*s.data("userinfo").money+t.money;s.data("userinfo").money=l,$(".jsBalance").text(l.toFixed(2))}else{var d=$(r("panelSuccTpl",{ptype:p,price:h,text:g}));$("body").append(d),d.on(x,".jsCheck",function(){window.setTimeout(function(){var e,n=t.orderid;e=2==p?"record.html?index=1":"/prizeclaw/todetail?orderid="+n,window.location=e},500)}),d.on(x,".jsContinue",function(){d.remove(),e.atips_center("success","奖品30日内兑换有效哦~")}),d.on(x,".jsCancle",function(){d.remove(),e.atips_center("success","奖品30日内兑换有效哦~")}),d.on(x,".jsBackRecharge",function(){var a=$(this);if(a.attr("disabled"))return!1;u({el:a,data:{recordid:t.recordid,type:3},success:function(n){$(".reddot").hide(),e.store.remove("dollOrder"),$(".jsRecordItem").attr("href","record.html?index=1");var a=t.money,i=$(".jsAdd");i.find("b").html(a);var o=$(r("award_bonus_tpl",{recharge:1,bonus:a}));d.remove(),$("body").append(o);var l=$(".panel-bonus-beans"),c=l.offset(),m=l.width(),f=l.height(),u=c.left+m,p=c.top+f;$("#jsBeanImg").css({left:u+"px",top:p+"px"}),setTimeout(function(){$("#jsBeanImg").parent().css("background","none"),$("#jsBeanImg").fadeIn();var n=($(".doll-bean-total"),$(".jsbeanImg"),new Parabola({origin:".panel-bonus-beans",target:".jsBeanTarget",a:-.06,element:"#jsBeanImg",time:200,callback:function(n){i.removeClass("none"),o.fadeOut(),setTimeout(function(){o.remove(),i.addClass("none");var n=1*s.data("userinfo").money+t.money;s.data("userinfo").money=n,$(".jsBalance").text(n.toFixed(2)),e.getUserInfo()},1200)}}));$("#jsBeanImg").addClass("fadeOut"),$(".jsBean01").addClass("beanScale"),n.move()},1e3)},fail:function(t){e.ntips_center(re.msg||n.tips_text.net_err)}})}),y.removeAttr("disabled")}e.getUserInfo(),i.checkTask()}}).move()}s.data("userinfo").money/1>=j&&(s.data("userinfo").money-=j,$(".jsBalance").text((s.data("userinfo").money/1).toFixed(2))),i.add(),k.find(".doll").attr("class","doll doll-cy"),$(".machine-arm-left").removeClass("swing-left"),$(".machine-arm-right").removeClass("swing-right");var o=k.find(".doll-item"),l=o.get(0);l.style[v.transform]="scale(.1)",l.style[v.transition]=O.replace("{{time}}",M),b?o.one(b,a):(clearTimeout(I),I=setTimeout(a,1e3*M))}F=(new Date).getTime(),L=F-z;var o=1e3*q-L;if(o=o>30?o:0,b){if(o>0)return c.one(b,a),!1;a()}else clearTimeout(w),w=setTimeout(a,o)}function o(t){function n(){function t(){o.addClass("none"),a.empty().attr("style",""),e.getUserInfo(),i.checkTask(),y.removeAttr("disabled")}s.data("userinfo").money/1>=j&&(s.data("userinfo").money-=j,$(".jsBalance").text((s.data("userinfo").money/1).toFixed(2))),i.add();var n=$(".doll-hold-fail-cont").height();k.find(".doll").attr("class","doll doll-cry");var a=$(".jsHoldFail"),r=a.get(0),o=$(".doll-exit"),l=k.html();a.html(l),o.removeClass("none"),k.empty(),k.attr("style",""),r.style.top=n+"px",r.style[v.transition]=H.replace("{{time}}",D),B.tipIndex||(B.tipIndex=1),e.atips_center("fail",B.tip[B.tipIndex]),B.tipIndex<3?B.tipIndex++:3==B.tipIndex&&(B.tipIndex=1),$(".machine-arm-left").removeClass("swing-left"),$(".machine-arm-right").removeClass("swing-right"),b?a.one(b,t):(clearTimeout(T),T=setTimeout(t,1e3*D))}F=(new Date).getTime(),L=F-z;var a=1e3*q-L;if(a=a>30?a:0,b){if(a>0)return c.one(b,n),!1;n()}else clearTimeout(C),C=setTimeout(n,a)}function l(t){e.ntips_center("网络不通畅，请刷新页面后重试")}k.empty().append(t.clone(!0)),t.css("visibility","hidden"),m.style[v.transition]=E.replace("{{time}}",q),m.style.height="0.96rem",$("#largeDollList").data("doll",t);var d=t.attr("data-pid"),p=t.attr("data-ptype"),g=t.attr("data-pname"),h=t.attr("data-price"),j=B.currentChip.attr("data-money"),_={money:j,pid:d,ptype:p},z=(new Date).getTime(),F=0,L=0;f(_,a,o,l)}():function(){$(".machine-arm-left").removeClass("swing-left"),$(".machine-arm-right").removeClass("swing-right"),B.tipnoIndex||(B.tipnoIndex=1),e.atips_center("fail",B.tipno[B.tipnoIndex]),B.tipnoIndex<2?B.tipnoIndex++:2==B.tipnoIndex&&(B.tipnoIndex=1),m.style[v.transition]=F.replace("{{time}}",D),m.style.height="0.96rem",b?c.one(b,function(){y.removeAttr("disabled")}):(clearTimeout(j),j=setTimeout(function(){y.removeAttr("disabled")},1e3*D))}()}var a=$(this),s=$(".doll-stage");if(a.attr("disabled"))return!1;a.attr("disabled","true");var l=$(".doll-machine"),d=($(".machine-handle"),$(".machine-bar")),c=(d.get(0),$(".machine-bar-wrap")),m=c.get(0),g=$(".machine-arm-left"),h=$(".machine-arm-right"),v=(l.css("height"),e.transformCss),b=e.whichTransitionEvent,_=null,k=$(".jsHoldSuc"),A=k.get(0),z=g.height();if($("#largeDollList").children().length<6)return a.removeAttr("disabled"),!1;if(!B.currentChip)return a.removeAttr("disabled"),!1;if(1!=e.cookie.get("IsLogin"))return window.location.href=o.loginHref,!1;if((s.data("userinfo").money/1||0)<B.currentChip.attr("data-money"))return p(),!1;var H=v.bezier,F="all {{time}}s cubic-bezier(0.215, 0.61, 0.355, 1)",E="all {{time}}s cubic-bezier(0.0, 0.0, 1.0, 1.0)",O="all {{time}}s cubic-bezier(0.455, 0.03, 0.515, 0.955)",q=1.2,D=1.2,M=.8;m.style[v.transition]=F.replace("{{time}}",.8),m.style.height="100%",g.addClass("swing-left"),h.addClass("swing-right");var L=$(".doll-box").eq(0).find("li");b?c.one(b,t):(clearTimeout(_),_=setTimeout(t,800))}function f(t,n,a,i){var t={pid:t.pid,money:t.money,ptype:t.ptype},r=function(t){if(!t.state&&-5==t.code)return void e.ntips_center("您未登录，正准备跳到登录页面！",function(){},function(){window.location.href=o.loginHref});if(t.state||-6!=t.code){if(!t.state)return void e.ntips_center(t.msg)}else e.ntips_center("活动已暂停,请刷新页面！");1==t.data.get?n&&n(t.data):a&&a(t.data)},s=function(e,t){i&&i(e,t)};o.requestAward(r,t,s)}function u(e){var t=e.el,n=function(t){"9999"==t.code&&e.success&&e.success(t)},a=function(e){console.log(e),t.removeClass("disabled")};o.exchange(n,e.data,a)}function p(){var t=function(t){return t.state||-5!=t.code?t.state?t.data.canGetExtraBean?void g():void e.ntips_center("余额不足,准备跳到充值页面！",function(){},function(){window.location.href=s.search.replace(o.rechargeHref,"beanCount",$("#jsdollbetbean").children(".current").attr("data-money")),btn.removeAttr("disabled")}):void e.ntips_center(t.msg):(e.ntips_center("您未登录，正准备跳到登录页面！"),void(window.location.href=o.loginHref))};o.askEgg(t)}function g(){function t(){if("true"!=$(".jsZadanBtn").attr("disabled")){$(".jsZadanBtn").attr("disabled","true"),a&&clearInterval(a);for(var e=[],t=0;t<3;t++){var n=[];n.push((t+0)*m),n.push((t+2/3)*m),e.push(n)}var a=setInterval(function(){var t=parseInt(i.css("left"));t<=f?g=Math.abs(g):t>=u&&(g=-Math.abs(g)),t+=g,i.css("left",t),(j+=Math.abs(g))>=v&&t>=e[h][0]&&t<=e[h][1]&&(clearInterval(a),I())},p)}}function n(){var t={eggIndex:h},n=function(t){function n(){a.remove(),$(".jsEggContainer").html("");var n=t.data.extraBean,i=$(".jsAdd");i.find("b").html(n);var o=$(r("award_bonus_tpl",{recharge:3,bonus:n}));$("body").append(o);var s=$(".panel-bonus-beans"),l=s.offset(),d=s.width(),c=s.height(),m=l.left+d,f=l.top+c;$("#jsBeanImg").css({left:m+"px",top:f+"px"}),setTimeout(function(){$("#jsBeanImg").parent().css("background","none"),$("#jsBeanImg").fadeIn();var n=($(".doll-bean-total"),$(".jsbeanImg"),new Parabola({origin:".panel-bonus-beans",target:".jsBeanTarget",a:-.06,element:"#jsBeanImg",time:200,callback:function(n){i.removeClass("none"),o.fadeOut(),setTimeout(function(){o.remove(),i.addClass("none");var n=1*b.data("userinfo").money+t.data.extraBean;b.data("userinfo").money=n,$(".jsBalance").text(n.toFixed(2)),e.getUserInfo(),y.removeAttr("disabled")},1200)}}));$("#jsBeanImg").addClass("fadeOut"),$(".jsBean01").addClass("beanScale"),n.move()},1e3)}return t.state||-5!=t.code?t.state?(a.find(".jsEggContainer").html(r("egg_tpl",{type:1,data:t.data.extraBeans})),void setTimeout(n,1e3)):void e.ntips_center(t.msg):(e.ntips_center("您未登录，正准备跳到登录页面！"),void(window.location.href=o.loginHref))};o.getEggBean(n,t)}var a=$($("#eggContainer_tpl").html());a.find(".jsEggContainer").html(r("egg_tpl",{type:0,data:[]})),$("body").append(a);var i=$(".zhuizi"),s=i.get(0),l=$(".zadan .content"),d=i.width(),c=l.width(),m=parseInt(l.find("li").eq(0).width()),f=d/3,u=c-f,p=40,g=d/18,h=parseInt(3*Math.random());console.log(h);var v=parseInt(Math.random()*m*5)+m,j=0;$(".jsZadanBtn").on(x,t);var I=function(){var t=e.transformCss,a=e.whichTransitionEvent,r=null;s.style[t.transition]="all {{time}}s cubic-bezier(1,-0.05,.7,.75)".replace("{{time}}",.4),s.style.top="-.6rem",i.addClass("rotate"),a?i.one(a,n):(clearTimeout(r),r=setTimeout(n,400))}}function h(){l(),d()}var v,b,y,x="click",B={onebet:null,currentChip:null,lotid:null,tipIndex:1,tip:{1:"差一点点，继续加油！",2:"别灰心，再来一次！",3:"换个姿势，感觉马上要中啦！"},tipno:{1:"没夹中，看准时机哦",2:"没夹中，不扣欢乐豆呦"},tipnoIndex:1,randInt:5};return{init:h}});